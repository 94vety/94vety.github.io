---
title: TCP
description: 传输控制协议（TCP，Transmission Control Protocol）是一种面向连接的、可靠的、基于字节流的传输层通信协议.
tags:  
- Network
---

## TCP 传输控制协议

* TCP 全称是传输控制协议，是一种面向有连接、安全可靠的、基础字节流的传输控制协议。

#### TCP 特性

* 1、面向连接
&nbsp;&nbsp;&nbsp;&nbsp;在发送数据前，双方需要建立连接，才能进行数据的正常发送.

* 2、仅支持单播传送
&nbsp;&nbsp;&nbsp;&nbsp;每条 TCP 传送只能在两个端点，之间进行点对点的传输，不支持多播、广播.

* 3、面向字节流
&nbsp;&nbsp;&nbsp;&nbsp;TCP不像UDP那样一个报文一个报文独立传输，而是在不保存报文边界的情况下以字节流的形式传输.

* 4、可靠性
&nbsp;&nbsp;&nbsp;&nbsp;TCP为了保证传输的可靠性给每一个包一个序号，同时也保证了传输到接收方的包是按序排列. 接收方对于已经接受的包会回传一个相应的确认（ACK），如果发送方在确认的往返时延（RTT）没有收到确认，就会重新发送.

* 5、提供拥塞控制
&nbsp;&nbsp;&nbsp;&nbsp;当网络出现阻塞的时候，TCP会减少发送数量和发送速率.

* 6、全双工通信
&nbsp;&nbsp;&nbsp;&nbsp;TCP允许通信的双方应用程序在任何时候发送数据，因为TCP在两端都设有缓存，来存放临时通信数据. TCP可以马上发送数据段，也可以缓存等待一段时候在发数据段，以便一次发送更多的数据（最大的数据段取决于MSS）.

#### 面向字节流

1. 两者的区别在于 TCP 接收的是一堆数据，而每次取多少由主机决定，而 UDP 发的是数据报，客户发送多少就接收多少.
2. 拥有这些区别的原因是由于 TCP 和 UDP 的特性不同而决定的.
3. TCP 是面向连接的，也就是说，在连接持续的过程中，socket 中收到的数据都是由同一台主机发出的，因此，知道保证数据是有序的到达就行了，至于每次读取多少数据自己看着办. 
4. UDP是无连接的协议，也就是说，只要知道接收端的 IP 和端口，且网络是可达的，任何主机都可以向接收端发送数据. 这时候，如果一次能读取超过一个报文的数据，则会乱套. 比如，主机 A 向发送了报文 P1，主机 B 发送了报文 P2，如果能够读取超过一个报文的数据，那么就会将 P1 和 P2 的数据合并在了一起，这样的数据是没有意义的.

#### 拥塞控制

* TCP 通过减少发送窗口大小来处理拥塞，发送窗口的大小由以下两个因素共同决定：

1、接收窗口大小（receiver window）
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;接收窗口大小是一种接收端对发送端的告知，用来说明接收者总计能接收多少字节未确认数据.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;发送者通过 TCP 头得知接收者接收窗口大小.

2、拥塞窗口大小（congestion window）
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;发送者发送的未确认数据应小于等于拥塞窗口大小，拥塞窗口的概念只存在于发送端.

3、发送窗口大小
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;取接收窗口大小和拥塞窗口大小的最小值.

#### TCP 应对拥塞的策略

* TCP 应对阻塞的三个阶段
&nbsp;&nbsp;&nbsp;&nbsp;1、慢启动（Slow Start）
&nbsp;&nbsp;&nbsp;&nbsp;2、拥塞避免（Congestion Avoidance）
&nbsp;&nbsp;&nbsp;&nbsp;3、拥塞探知（Congestion Detection）

* 慢启动阶段

一开始发送端设置拥塞窗口等于一个最大报文段（1 MSS），在接收到确认 ACK 后，发送端把拥塞窗口增加 1 MSS，整个过程中拥塞窗口按照预设规则增大（指数级）.

![慢启动](https://s1.ax1x.com/2020/10/28/B8icE6.png)

1、第一轮 ack，拥塞窗口 = 2 MSS
2、第二轮 ack，拥塞窗口 = 4 MSS
3、第三轮 ack，拥塞窗口 = 8 MSS

上述过程一直轮询，知道拥塞窗口的大小达到慢启动的阀值.

* 拥塞避免阶段


* 拥塞感知阶段

